{% extends "base.html" %}

{% block scripts %}
    {{ super() }}

    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@4.3.0/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@4.3.0/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@4.3.0/main.min.js"></script>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js'></script>
    <script src="{{ url_for('static', filename='js/glenScripts.js') }}"></script>

{% endblock %}
{% block head %}
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Medication Calendar</title>

  <!-- Bootstrap CSS -->
 

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  <!-- FullCalendar CSS (make sure versions match your JS) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/core@4.3.0/main.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@4.3.0/main.min.css">

  <!-- Your custom calendar styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='..css/glenCalendarStyle.css') }}">
{% endblock %}

{% block content %}
<body>
    <div class="container-fluid">
        <div class="page-header">
            <h1 class="display-5 fw-bolder mb-0 mx-5 mb-5 text-center mt-5">
                <span class="text-gradient d-inline mb-2">Medication & Event Log</span>
            </h1>
            
        </div>
        <div class="custom-toolbar">
            <div class="toolbar-row d-flex flex-column flex-md-row gap-2 justify-content-md-start mb-2">
                <button class="btn btn-primary" onclick="window.location.href='/add_medication'">
                    <i class="fas fa-pills"></i> Add Medication
                </button>
                <button class="btn btn-danger" onclick="window.location.href='/add_seizure'">
                    <i class="fas fa-bolt"></i> Track Seizure
                </button>
            </div>

            <div class="toolbar-row d-flex flex-column flex-md-row gap-2 justify-content-md-start mb-2">
                <button class="btn btn-outline-secondary" onclick="calendar.today()">Today</button>
                <button class="btn btn-outline-secondary" onclick="calendar.prev()">‹</button>
                <button class="btn btn-outline-secondary" onclick="calendar.next()">›</button>
            </div>

            <div class="toolbar-row text-center text-md-start mb-3">
                <h4 id="calendarTitle">Loading...</h4>
            </div>
        </div>
        <div id='calendar'></div>
    </div>

    <!-- Floating Action Buttons for Mobile -->
    <div class="fab-container">
        <button class="fab" onclick="window.location.href='/add_medication'" title="Add Medication">
            <i class="fas fa-pills"></i>
        </button>
        <button class="fab danger" onclick="window.location.href='/add_seizure'" title="Track Seizure">
            <i class="fas fa-bolt"></i>
        </button>
    </div>

    <!-- Add/Edit Modal -->
    <div class="modal fade" id="medicationModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalLabel">
                        <i class="fas fa-plus-circle"></i> Add Medication
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="medicationForm">
                    <div class="modal-body">
                        <div class="alert alert-danger" id="errorAlert" style="display: none;"></div>
                        
                        <input type="hidden" id="medicationId" name="medication_id">
                        
                        <div class="row mb-3">
                            <div class="col-md-8 col-12 mb-3 mb-md-0">
                                <div class="form-group">
                                    <label for="name">Medication Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="name" name="name" placeholder="Enter medication name" required>
                                </div>
                            </div>
                            <div class="col-md-4 col-12">
                                <div class="form-group">
                                    <label for="dosage">Dosage <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="dosage" name="dosage" placeholder="e.g., 50mg" required>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-4 col-12 mb-3 mb-md-0">
                                <div class="form-group">
                                    <label for="start_date">Start Date <span class="text-danger">*</span></label>
                                    <input type="date" class="form-control" id="start_date" name="start_date" required>
                                </div>
                            </div>
                            <div class="col-md-4 col-12 mb-3 mb-md-0">
                                <div class="form-group">
                                    <label for="end_date">End Date <small class="text-muted">(Optional)</small></label>
                                    <input type="date" class="form-control" id="end_date" name="end_date">
                                </div>
                            </div>
                            <div class="col-md-4 col-12">
                                <div class="form-group">
                                    <label for="time_to_take">Time to Take <span class="text-danger">*</span></label>
                                    <input type="time" class="form-control" id="time_to_take" name="time_to_take" required>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-8 col-12 mb-3 mb-md-0">
                                <div class="form-group">
                                    <label for="frequency">Frequency <span class="text-danger">*</span></label>
                                    <select class="form-select" id="frequency" name="frequency" required>
                                        <option value="">Select frequency</option>
                                        <option value="daily">Daily</option>
                                        <option value="twice_daily">Twice Daily</option>
                                        <option value="three_times_daily">Three Times Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                        <option value="as_needed">As Needed</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4 col-12">
                                <div class="form-group">
                                    <label for="color">Calendar Color</label>
                                    <input type="color" class="form-control form-control-color" id="color" name="color" value="#3788d8" style="height: 45px;">
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="instructions">Special Instructions <small class="text-muted">(Optional)</small></label>
                            <textarea class="form-control" id="instructions" name="instructions" rows="3" placeholder="Take with food, avoid alcohol, etc."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success" id="submitBtn">
                            <i class="fas fa-plus"></i> Add Medication
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteModalLabel">
                        <i class="fas fa-exclamation-triangle"></i> Confirm Deletion
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this item?</p>
                    <div class="medication-info" id="itemToDelete"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDelete">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>
        </div>
    </div>



    
</body>
{% endblock %}
